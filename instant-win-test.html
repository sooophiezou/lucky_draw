<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucky Draw: Win Your Huawei Earbuds</title>
    <style>
        :root { --primary-red: #e60012; --deep-black: #1a1a1a; }
        body { font-family: sans-serif; background: #000; color: #fff; text-align: center; padding: 20px; }
        
        /* ËΩ¨ÁõòÂ§ñÊ°Ü */
        .wheel-outer {
            position: relative;
            width: 340px; height: 340px;
            margin: 0 auto;
            border: 10px solid #222;
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(230,0,18,0.3);
        }

        .pointer {
            position: absolute; top: -25px; left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 15px solid transparent; border-right: 15px solid transparent;
            border-top: 35px solid var(--primary-red);
            z-index: 20;
        }

        #wheelCanvas { border-radius: 50%; transition: transform 5s cubic-bezier(0.15, 0, 0.1, 1); }

        .spin-btn {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 60px; height: 60px;
            background: var(--primary-red); color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: bold; cursor: pointer; border: 3px solid #fff; z-index: 25; font-size: 12px;
        }

        .prize-card {
            margin-top: 30px; background: #111; padding: 15px;
            border-radius: 15px; width: 300px; display: inline-block; border: 1px solid #333;
        }
        .prize-card img { width: 100%; border-radius: 8px; }

        #overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100; justify-content: center; align-items: center;
        }
        .modal { background: #222; padding: 30px; border-radius: 20px; border: 1px solid var(--primary-red); }
        .modal button { background: var(--primary-red); color: #fff; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>üèÜ GRAND DRAW</h1>
    
    <div class="wheel-outer">
        <div class="pointer"></div>
        <canvas id="wheelCanvas" width="340" height="340"></canvas>
        <div class="spin-btn" onclick="startSpin()">SPIN</div>
    </div>

    <div class="prize-card">
        <img src="https://raw.githubusercontent.com/sooophiezou/lucky_draw/main/eirbuds.png" alt="Prize">
        <p style="color:#f7ef8a; font-weight:bold;">Huawei FreeClip Open-Ear Wireless Earbuds, ‚Ç¨199</p>
    </div>

    <div id="overlay"><div class="modal" id="modalContent"></div></div>

    <script>
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        
        const sectors = [
            { text: "Very close! ü§è", color: "#111" },
            { text: "No luck! üòÖ", color: "#222" },
            { text: "One more! ‚ö°", color: "#333" },
            { text: "PRIZE üéÅ", color: "#e60012" }, // Â•ñÂìÅÂå∫
            { text: "No luck! üòÖ", color: "#111" },
            { text: "Very close! ü§è", color: "#222" },
            { text: "Try again! üîÑ", color: "#333" },
            { text: "No luck! üòÖ", color: "#222" }
        ];

        const img = new Image();
        img.crossOrigin = "anonymous"; 
        // ÂÖ≥ÈîÆÔºöÂøÖÈ°ª‰ΩøÁî® raw ÈìæÊé•
        img.src = 'https://raw.githubusercontent.com/sooophiezou/lucky_draw/main/eirbuds.png';

        let rotation = 0;
        let spinning = false;

        function drawWheel() {
            const arc = (Math.PI * 2) / sectors.length;
            ctx.clearRect(0, 0, 340, 340);

            sectors.forEach((s, i) => {
                const angle = i * arc;
                // 1. ÁªòÂà∂ÊâáÂΩ¢
                ctx.fillStyle = s.color;
                ctx.beginPath();
                ctx.moveTo(170, 170);
                ctx.arc(170, 170, 170, angle, angle + arc);
                ctx.fill();
                
                // 2. ÁªòÂà∂ÊñáÂ≠ó/ÂõæÁâá
                ctx.save();
                ctx.translate(170, 170);
                ctx.rotate(angle + arc / 2);
                
                if (s.text.includes("PRIZE")) {
                    if (img.complete) {
                        ctx.drawImage(img, 90, -25, 50, 50);
                    } else {
                        ctx.fillStyle = "#fff";
                        ctx.fillText("PRIZE", 110, 5);
                    }
                } else {
                    ctx.textAlign = "right";
                    ctx.fillStyle = "#bbb";
                    ctx.font = "bold 12px Arial";
                    ctx.fillText(s.text, 150, 5);
                }
                ctx.restore();
            });
        }

        // Á°Æ‰øùÂõæÁâáÂä†ËΩΩÂíåÈáçÁªò
        img.onload = () => { drawWheel(); };
        // Âç≥‰ΩøÂõæÁâáÊ≤°Âä†ËΩΩ‰πüÂÖàÁîªÂá∫ÊâáÂΩ¢
        drawWheel();

        function startSpin() {
            if (spinning) return;
            
            const won = parseInt(localStorage.getItem('wonCount_v3') || 0);
            const canWin = (Math.random() < 0.1) && (won < 5); // 10% Ê¶ÇÁéá & 5‰∏™ÈôêÂà∂
            
            spinning = true;
            let targetIdx = canWin ? 3 : [0,1,2,4,5,6,7][Math.floor(Math.random()*7)];

            const sectorAngle = 360 / sectors.length;
            const stopAngle = 360 - (targetIdx * sectorAngle) - (sectorAngle / 2);
            rotation += (360 * 8) + stopAngle - (rotation % 360);
            
            canvas.style.transform = `rotate(${rotation}deg)`;

            setTimeout(() => {
                spinning = false;
                showResult(canWin);
            }, 5000);
        }

        function showResult(win) {
            const overlay = document.getElementById('overlay');
            const modal = document.getElementById('modalContent');
            overlay.style.display = 'flex';

            if (win) {
                let count = parseInt(localStorage.getItem('wonCount_v3') || 0);
                localStorage.setItem('wonCount_v3', count + 1);
                modal.innerHTML = `<h2>üéâ WINNER!</h2><img src="${img.src}" width="100"><p>You won the Huawei Buds!</p><button onclick="location.reload()">OK</button>`;
            } else {
                modal.innerHTML = `<h2>Better Luck Next Time</h2><p>Please try again tomorrow.</p><button onclick="location.reload()">CLOSE</button>`;
            }
        }
    </script>
</body>
</html>
